<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500;700&family=Noto+Sans+KR:wght@100;400&family=Playfair+Display:ital@1&display=swap"
      rel="stylesheet"
    />
    <title>투두리스트</title>
  </head>
  <body>
    <div id="container">
      <div id="card">
        <h1>Notes App</h1>
        <p>Take notes and never forget</p>
        <div class="search">
          <input type="text" class="search__input" placeholder="Search" />
          <select name="sort" class="search__select" id="sort">
            <option value="defalut">최신순</option>
            <option value="latest">수정시간순</option>
          </select>
        </div>
        <div class="back none">
          <button class="btn back__btn">&lt;&nbsp;Back</button>
          <div class="time"></div>
        </div>
        <div id="list">
          <ul>
            <li class="no-result">No Result</li>
          </ul>
        </div>
        <form class="note none">
          <input type="text" name="title" placeholder="Note Title" required />
          <textarea name="content" cols="30" rows="10" placeholder="Enter note text" required></textarea>
          <div class="change none">
            <button type="submit" class="btn remove">Remove Note</button>
            <button type="submit" class="btn done">Done</button>
            <button type="submit" class="btn update none">Update</button>
          </div>
        </form>
        <div class="default">
          <button type="button" class="btn create">Create Note</button>
        </div>
      </div>
    </div>
    <script>
      const $form = document.querySelector('form');
      const $backBtn = document.querySelector('.back__btn');
      const $createBtn = document.querySelector('.create');
      const $updateBtn = document.querySelector('.update');
      const $removeBtn = document.querySelector('.remove');
      const $doneBtn = document.querySelector('.done');
      const $defaultDiv = document.querySelector('.default');
      const $ul = document.querySelector('#list ul');
      const $li = document.querySelector('li');
      const $noResult = document.querySelector('.no-result');
      const $changeDiv = document.querySelector('.change');
      const $searchDiv = document.querySelector('.search');
      const $backDiv = document.querySelector('.back');

      const todolist = [];
      let title;
      let content;
      let cnt = 0;

      // 뒤로가기
      function onClickBack(event) {
        event.preventDefault();
        $form.classList.add('none');
        $changeDiv.classList.add('none');
        $backDiv.classList.add('none');
        $defaultDiv.classList.remove('none');
        $searchDiv.classList.remove('none');
        $ul.classList.remove('none');
        $updateBtn.classList.add('none');
        $doneBtn.classList.remove('none');

        $form.elements[0].value = ''; // title
        $form.elements[1].value = ''; // content

        if ($updateBtn && $removeBtn) {
          console.log('이벤트 삭제');
          $updateBtn.removeEventListener('click', onUpdateList);
          $removeBtn.removeEventListener('click', onRemoveList);
        }

        console.log('뒤로가기');
      }

      $backBtn.addEventListener('click', onClickBack);

      // 생성버튼
      const clickCreateBtn = () => {
        $form.classList.remove('none');
        $backDiv.classList.remove('none');
        $defaultDiv.classList.add('none');
        $searchDiv.classList.add('none');
        $changeDiv.classList.remove('none');
        $ul.classList.add('none');

        console.log('생성버튼');
        $form.addEventListener('submit', onCreateList);
      };

      $createBtn.addEventListener('click', clickCreateBtn);

      // 투두리스트 생성
      const onCreateList = event => {
        event.preventDefault();
        $form.classList.add('none');
        $changeDiv.classList.add('none');
        $backDiv.classList.add('none');
        $searchDiv.classList.remove('none');
        $defaultDiv.classList.remove('none');
        $ul.classList.remove('none');

        const contents = {
          id: cnt,
          title: event.target.title.value,
          content: event.target.content.value,
        };

        todolist.push(contents);
        event.target.title.value = '';
        event.target.content.value = '';
        cnt++;
        console.log(todolist);
        console.log('리스트 생성!');
        $form.removeEventListener('click', onCreateList);
        $removeBtn.removeEventListener('click', onRemoveList);

        showTodoList();
      };

      // 삭제
      const onRemoveList = id => event => {
        event.preventDefault();
        $form.classList.add('none');
        $changeDiv.classList.add('none');
        $backDiv.classList.add('none');
        $updateBtn.classList.add('none');
        $defaultDiv.classList.remove('none');
        $searchDiv.classList.remove('none');
        $ul.classList.remove('none');
        $doneBtn.classList.remove('none');

        const result = todolist.filter(list => list.id !== id);
        // console.log(`삭제 후 배열: ${JSON.stringify(result)}`);
        todolist.splice(0, todolist.length, ...result);

        $form.elements[0].value = ''; // title
        $form.elements[1].value = ''; // content

        $removeBtn.removeEventListener('click', onRemoveList);
        $updateBtn.removeEventListener('click', onUpdateList);

        console.log('삭제!');
        showTodoList();
      };

      const $div = document.createElement('div');

      // 투두리스트 목록화면
      function dislplayTodoList() {
        $ul.innerHTML = '';
        todolist.forEach(list => {
          const $li = document.createElement('li');
          $li.textContent = `id: ${list.id} title: ${list.title} content: ${list.content}`;
          $li.addEventListener('click', onClickList(list));

          $ul.append($li);
        });
      }

      function showTodoList() {
        if (todolist.length > 0) {
          $noResult.classList.add('none');
        }

        dislplayTodoList();

        console.log('투두리스트 목록표시!');
        console.log(todolist);
      }

      // 투두리스트 상세정보
      const onClickList = list => event => {
        event.preventDefault();
        $form.classList.remove('none');
        $changeDiv.classList.remove('none');
        $backDiv.classList.remove('none');
        $searchDiv.classList.add('none');
        $defaultDiv.classList.add('none');
        $doneBtn.classList.add('none');
        $updateBtn.classList.remove('none');
        $ul.classList.add('none');

        $form.title.value = list.title;
        $form.content.value = list.content;

        console.log('현재 리스트: ' + JSON.stringify(list));

        // $form.removeEventListener('submit', onCreateList);
        $updateBtn.addEventListener('click', onUpdateList(list));
        $removeBtn.addEventListener('click', onRemoveList(list.id));
      };

      // 업데이트
      const onUpdateList = list => event => {
        event.preventDefault();
        $doneBtn.classList.remove('none');
        $updateBtn.classList.add('none');
        $form.classList.add('none');
        $changeDiv.classList.add('none');
        $backDiv.classList.add('none');
        $searchDiv.classList.remove('none');
        $defaultDiv.classList.remove('none');
        $ul.classList.remove('none');

        const contents = {
          ...list,
          title: $form.elements[0].value,
          content: $form.elements[1].value,
        };

        console.log('리스트 업데이트!');
        todolist.splice(list.id, 1, contents);

        $form.elements[0].value = '';
        $form.elements[1].value = '';
        $updateBtn.removeEventListener('click', onUpdateList);
        $removeBtn.removeEventListener('click', onRemoveList);

        showTodoList();
      };
    </script>
  </body>
</html>
